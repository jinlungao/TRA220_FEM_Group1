import matplotlib.pyplot as plt
import numpy as np

# ------------------------------
# 数据：你已有的 CPU 和 GPU 数据
# ------------------------------
elements = np.array([10,272,535,797,1060,1323,1585,1848,2111,2373,2636,2898,3161,3424,3686,3949,4212,4474,4737,5000])

# CPU
cpu_assembly = np.array([
    0.001095,0.024636,0.049358,0.073837,0.101553,0.126912,0.152062,0.173569,
    0.197417,0.224148,0.244697,0.272132,0.296892,0.320881,0.346666,0.370255,
    0.390877,0.420094,0.443223,0.464238
])
cpu_solve = np.array([
    0.010511,0.083487,0.240066,0.460324,1.025210,1.630504,2.321388,3.290919,
    5.158371,6.850395,8.494740,11.462414,14.729769,17.929461,22.572374,
    27.526383,29.730567,37.402651,44.159317,48.232485
])
cpu_total = np.array([
    0.013293,0.112170,0.300491,0.554628,1.160799,1.809822,2.552226,3.587671,
    5.525681,7.300717,9.033534,12.117139,15.488158,18.842868,23.536257,
    28.590241,30.880464,38.698420,45.559339,49.739213
])

# GPU raw data
gpu_assembly = np.array([
    0.009186,0.132107,0.266557,0.405308,0.527336,0.655458,0.774238,0.898097,
    1.042744,1.170962,1.297459,1.418363,1.551028,1.708732,1.811022,1.946435,
    2.046211,2.199331,2.331858,2.458705
])

gpu_cholesky = np.array([
    0.016626,0.001695,0.019037,0.004679,0.005635,0.008399,0.011795,0.015795,
    0.020042,0.023809,0.030238,0.037123,0.043564,0.052961,0.149079,0.162657,
    0.173212,0.255707,0.243570,0.270991
])

gpu_tri = np.array([
    0.027917,0.030546,0.036314,0.044146,0.056329,0.069864,0.085040,0.099907,
    0.126587,0.143928,0.171848,0.203369,0.215126,0.245928,0.306469,0.375445,
    0.390552,0.382496,0.425738,0.461994
])

gpu_total = np.array([
    0.253971,0.226236,0.382006,0.517557,0.647591,0.792787,0.930879,1.074297,
    1.250544,1.402880,1.564593,1.724319,1.872204,2.070768,2.333520,2.549862,
    2.676094,2.905615,3.068522,3.260343
])

# 合并 GPU 求解时间
gpu_solve = gpu_cholesky + gpu_tri

# ------------------------------
# 绘图：CPU vs GPU 对比
# ------------------------------
plt.figure(figsize=(12,7))

plt.plot(elements, cpu_assembly, marker='o', label="CPU Assembly")
plt.plot(elements, gpu_assembly, marker='o', label="GPU Assembly")

plt.plot(elements, cpu_solve, marker='o', label="CPU Solve")
plt.plot(elements, gpu_solve, marker='o', label="GPU Solve")

plt.plot(elements, cpu_total, marker='o', label="CPU Total")
plt.plot(elements, gpu_total, marker='o', label="GPU Total")

plt.xlabel("Number of Elements (m)")
plt.ylabel("Runtime (seconds)")
plt.title("CPU vs GPU FEM Performance Comparison")

plt.grid(True)
plt.legend()
plt.tight_layout()
plt.show()
